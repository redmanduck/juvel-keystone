<form method="POST" action="/checkout/next">
	<div class="container">
		<input type="hidden" name="_next" value="payment"/>
		<ol class="breadcrumb sukhumvit">
			<li>ตะกร้า</li>
			<li>ข้อมูลผู้รับ</li>
			<li class="active">วิธีจัดส่ง</li>
			<li>ช่องทางการชำระเงิน</li>
		</ol>
		<div class="row">
			<div class="col-md-5 col-sm-6">
				
				<div class="list-group">
					{{#each _shippingMethod}}
					
				  	<label class="list-group-item" style="font-weight:normal">
						
						<strong>{{ title }} <br/></strong>
						<span >{{ description }}</span>

						<p>
						<span data-fee="{{ fixedFeeAmount }}" data-shipping-id="{{_id}}" class="fixedFeeAmount">{{ fixedFeeAmount }}</span> 
						บาท <input type="radio" name="shipping[_id]" value="{{_id}}" class="shipping_mode_radio"> 
						</p>
						
				  	</label>
					{{/each}}

				</div>
			</div>
			<div class="col-md-4 col-sm-6 align-right pull-right">
				<div class="input-group">
					<input type="text" class="form-control" name="promo" value="{{cart_order.promo}}" placeholder="ใช้สิทธิ PROMO CODE"/>
					<span class="input-group-btn">
						<button class="btn btn-primary">Apply</button>
					</span>
				</div></br>
				<input type="hidden" class="calc-shipping-fee fee-entry" name="shipping[fee]" value="0.00"/>
				<table class="table">
					{{#each cart_order.items }}
						<input type="hidden" class="fee-entry" value="{{ basePrice }}"/>
						<tr><td>{{title}} <small>{{ qty }} ชิ้น</small></td><td>{{ basePrice }}</td></tr>
					{{/each}}
					<tr><td>ค่าจัดส่ง (Shipping)</td><td class="calc-shipping">{{ cart_order.shipping.fee }}</td></tr>
				</table>
				<h2><small class="sukhumvit">ทั้งหมด</small> <br/><span class="value-subtotal"></span> <small>.-</small></h2>
				<hr/>
			</div>
		</div>
		<div class="row">
			<div class="col-md-3 col-sm-4 col-xs-12 align-right pull-right">
				<a href="/checkout/information" class="btn btn-default sukhumvit">กลับไปแก้ไข</a>
				<button type="submit" href="#" class="btn btn-primary sukhumvit">ถัดไป</button>
			</div>
		</div>
	</div>
	
</form>
<script>
	var selId = '{{ cart_order.shipping._id }}';
	console.log(selId);

	function digest(){
		$('.list-group-item').removeClass('active');
		$('.list-group-item:has(input:checked)').addClass('active');

		var selectedShippingId = $( "[type=radio]:checked" ).attr("value");
		var selectedFee = Number($(".fixedFeeAmount[data-shipping-id=" + selectedShippingId +  "]").attr("data-fee"));
		$(".calc-shipping").text(selectedFee);
		$(".calc-shipping-fee").val(selectedFee);

		var feeSum = 0;
		$('.fee-entry').each(function(){
			feeSum += Number($(this).val());
		});
		
		$(".value-subtotal").text(feeSum);
	}

	if(selId.length > 0){
		$( "[type=radio][value=" + selId + "]" ).prop("checked", true);
		digest();
	}

	$(".shipping_mode_radio").change(function(){
		digest();
	});
</script>